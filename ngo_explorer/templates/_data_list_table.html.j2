{% macro pagination() %}
<div class="mb2 lh-copy f6">
    {% set skip = filters.get("filter-skip", 0)|int %}
    <ul class="list mh0 mb0 mt1 pa0 flex justify-between">
        {% if skip > 0 %}
        <li class="dib">
            {% if (skip - 30) > 0 %}
            <a class="link blue" href="{{ pages[active_page].url|update_url({"filter-skip": 0}) }}">
                <i class="material-icons md-18 v-mid">first_page</i>
            </a>
            {% endif %}
            <a class="link blue" href="{{ pages[active_page].url|update_url({"filter-skip": skip - 30}) }}">
                <i class="material-icons md-18 v-mid">chevron_left</i><span class="v-mid">Previous</span>
            </a>
        </li>
        {% endif %}
        <li class="dib v-mid">
            {% if data.count <= 30 %}
            Showing all <strong>{{ "{:,.0f}".format(data.count) }}</strong> NGOs
            {% else %}
            Showing <strong>{{ "{:,.0f}".format(1 + skip) }}</strong>
            to <strong>{{ "{:,.0f}".format([30 + skip, data.count]|min) }}</strong>
            of <strong>{{ "{:,.0f}".format(data.count) }}</strong> NGOs
            {% endif %}
        </li>
        {% if skip + 30 < data.count %}
        <li class="dib">
            <a class="link blue" href="{{ pages[active_page].url|update_url({"filter-skip": skip + 30}) }}">
                <span class="v-mid">Next</span><i class="material-icons md-18 v-mid">chevron_right</i>
            </a>
            {% if skip + 60 < data.count %}
            <a class="link blue" href="{{ pages[active_page].url|update_url({"filter-skip": data.count - 30}) }}">
                <i class="material-icons md-18 v-mid">last_page</i>
            </a>
            {% endif %}
        </li>
        {% endif %}
    </ul>
</div>
{% endmacro %}


{{ pagination() }}
<table class="collapse f5 lh-copy">
    <thead>
        <tr class="f4 bb b--mid-gray bw2">
            <th class="pa2 v-top tl dn dtc-ns mw5">Charity</th>
            <th class="pa2 v-top tr dn dtc-ns"><abbr title="Registration">Reg</abbr>. date</th>
            <th class="pa2 v-top tr dn dtc-ns">Latest income</th>
            <th class="pa2 v-top tl dn dtc-ns mw6">Activities</th>
            <th class="pa2 v-top tl dn dtc-ns">Region <span class="normal gray underline" title="based on registered office of UK charity">?</span></th>
        </tr>
    </thead>
    <tbody id="data-list">
    {% for c in data.list %}
        <tr class="db dt-row-ns bb b--light-gray bw1">
            <td class="pa2 v-top db dtc-ns mw5">
                <a class="link blue" href="{{ url_for('data.charity', charityid=c.id) }}">
                    <p class="pa0 ma0 b blue">{{ c.name|correct_titlecase }}</p>
                    <p class="f7 gray mb0 mt2">Charity number <strong>{{ c.id }}</strong></p>
                </a>
            </td>
            <td class="pa2 v-top db dtc-ns">
                {{ "{:%d/%m/%Y}".format(c.registrationDate) }}
            </td>
            <td class="pa2 v-top tr db dtc-ns">
            {% if c.finances and c.finances[0].income %}
                <p class="pa0 ma0 di db-ns">
                    <span class="di dn-ns">Latest income </span>
                    {{ "Â£{:,.0f}".format(c.finances[0].income) }}
                </p>
                {% if c.finances[0].financialYear %}
                <p class="f7 gray mb0 mt2 di db-ns">[{{ "{:%b %Y}".format(c.finances[0].financialYear.end) }}]</p>
                {% endif %}
            {% endif %}
            </td>
            <td class="pa2 v-top db dtc-ns mw6">
                {{ c.activities|default("", true)|correct_titlecase }}
                {% if '302' in c.operations %}
                <p class="i f6 mv2">Makes grants</p>
                {% endif %}
                <p class="i f6 mv2">
                Work in 
                {% for a in c.countries %}
                    {%- if loop.last and not loop.first %} and {% endif %}
                    {%- if not loop.last and not loop.first -%}, {% endif %}
                    {{- a.name -}}
                {% endfor %}
                <p>
            </td>
            <td class="pa2 v-top db dtc-ns"><span class="di dn-ns">UK registered office: </span>{{ c.geo.region|default(c.geo.country|default("", true), true) }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{{ pagination() }}